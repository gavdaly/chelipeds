#!/usr/bin/env bash
set -euo pipefail
FLAG="/var/lib/chelipeds/updates-available"
if [ -f "$FLAG" ]; then
  echo '{"text":"⬆ updates","tooltip":"System updates available (rpm-ostree)","class":"warn"}'
  exit 0
fi
if [ -f /var/lib/chelipeds/upgrade-check.txt ]; then
  when=$(stat -c %y /var/lib/chelipeds/upgrade-check.txt 2>/dev/null | cut -d'.' -f1)
  echo "{\"text\":\"✓ up-to-date\",\"tooltip\":\"Last checked: $when\",\"class\":\"good\"}"
else
  echo '{"text":"?","tooltip":"No update check history","class":"bad"}'
fi

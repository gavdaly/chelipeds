{
  "ref": "chelipeds/42/x86_64/hyperland-dev",
  "repos": ["fedora", "fedora-updates"],
  "selinux": true,
  "automatic-version-prefix": "42",
  "releasever": "42",
  "bootstrap-package": "basesystem",
  "packages": [
    // Hyprland desktop
    "hyperland",
    "waybar",
    "wofi",
    "mako",
    "wl-clipboard",
    "grim",
    "slurp",
    "swappy",
    "swaybg",
    "swaylock",
    "xdg-desktop-portal-wlr",
    "xdg-desktop-portal-gtk",
    "nerd-fonts",
    "ghostty",
    "kitty",

    // Dev stack
    "neovim",
    "gcc",
    "gcc-c++",
    "clang",
    "cmake",
    "ninja-build",
    "make",
    "gdb",
    "git",

    // Containers
    "podman",
    "podman-compose",
    "buildah",
    "skopeo",
    "crun",
    "podman-tui",
    "podman-desktop",
    "toolbox",
    "distrobox",

    // Flatpak support + GUI store
    "flatpak",
    "gnome-software",
    "gnome-software-plugin-flatpak",

    // Networking/system
    "curl",
    "wget",
    "rsync",
    "jq",
    "htop",
    "strace",
    "lsof",
    "tcpdump",
    "traceroute",
    "tailscale",
    "nfs-utils",
    "mosh",
    "wireguard-tools"
  ],
  "default-target": "graphical.target",
  "postprocess": [
    {
      "type": "script",
      "commands": [
        // Flathub
        "flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo",

        // Core Flatpaks
        "flatpak install -y flathub org.chromium.Chromium",
        "flatpak install -y flathub dev.zed.Zed",
        "flatpak install -y flathub com.visualstudio.code",
        "flatpak install -y flathub io.loft.DevPod",

        // Flatpak overrides: Wayland, GPU, home
        "flatpak override --user --socket=wayland --device=dri --filesystem=home org.chromium.Chromium",
        "flatpak override --user --socket=wayland --device=dri --filesystem=home dev.zed.Zed",
        "flatpak override --user --socket=wayland --device=dri --filesystem=home com.visualstudio.code",
        "flatpak override --user --socket=wayland --device=dri --filesystem=home io.loft.DevPod",

        // CLI symlinks for Flatpaks
        "ln -sf /var/lib/flatpak/exports/bin/dev.zed.Zed /usr/local/bin/zed",
        "ln -sf /var/lib/flatpak/exports/bin/com.visualstudio.code /usr/local/bin/code",
        "ln -sf /var/lib/flatpak/exports/bin/io.loft.DevPod /usr/local/bin/devpod",

        // Rust + cargo-binstall
        "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y",
        "cargo install cargo-binstall || true",

        // Python (uv) + latest Python
        "curl -LsSf https://astral.sh/uv/install.sh | sh",
        "uv python install latest",
        "uv python pin latest",

        // Node.js via Volta + common CLIs
        "curl https://get.volta.sh | bash",
        "volta install @anthropic-ai/claude-code @google/gemini-cli @openai/codex",
        "volta install typescript ts-node eslint prettier npm-check-updates vite vitest jest nodemon http-server",

        // Rust CLIs via cargo-binstall
        "cargo binstall -y just cargo-update cargo-edit cargo-watch cargo-nextest",
        "cargo binstall -y fzf ripgrep fd-find bat yq eza bottom btop bandwhich gitui lazygit yazi nnn ranger",
        "cargo binstall -y tokei kmon lazydocker dua-cli dust broot procs tealdeer xh gping",
        "cargo binstall -y eva pastel hyperfine starship zellij jj lazyjj",

        // ### Automation & Maintenance (systemd timers)
        // Create update-tools script
        "cat <<'EOF' > /usr/local/bin/update-tools.sh",
        "#!/usr/bin/env bash",
        "set -euxo pipefail",
        "# Update Rust",
        "$HOME/.cargo/bin/rustup update || true",
        "# Update cargo-binstalled CLIs",
        "$HOME/.cargo/bin/cargo install-update -a || true",
        "# Update Python via uv",
        "$HOME/.local/bin/uv python install latest && $HOME/.local/bin/uv python pin latest || true",
        "# Update Node.js + Volta-managed tools",
        "$HOME/.volta/bin/volta install node@latest || true",
        "$HOME/.volta/bin/volta install npm-check-updates eslint prettier typescript ts-node vite vitest jest nodemon http-server || true",
        "EOF",
        "chmod +x /usr/local/bin/update-tools.sh",

        // systemd service for update-tools
        "cat <<'EOF' > /etc/systemd/system/update-tools.service",
        "[Unit]",
        "Description=Update Rust, Node, Python, and CLI tools",
        "",
        "[Service]",
        "Type=oneshot",
        "ExecStart=/usr/local/bin/update-tools.sh",
        "EOF",

        // systemd timer for update-tools (daily 03:00)
        "cat <<'EOF' > /etc/systemd/system/update-tools.timer",
        "[Unit]",
        "Description=Run update-tools daily at 03:00",
        "",
        "[Timer]",
        "OnCalendar=*-*-* 03:00:00",
        "Persistent=true",
        "",
        "[Install]",
        "WantedBy=timers.target",
        "EOF",

        // systemd service for rpm-ostree upgrade
        "cat <<'EOF' > /etc/systemd/system/ostree-upgrade.service",
        "[Unit]",
        "Description=Upgrade system with rpm-ostree",
        "",
        "[Service]",
        "Type=oneshot",
        "ExecStart=/usr/bin/rpm-ostree upgrade --allow-inactive",
        "EOF",

        // systemd timer for rpm-ostree upgrade (daily 03:15)
        "cat <<'EOF' > /etc/systemd/system/ostree-upgrade.timer",
        "[Unit]",
        "Description=Run rpm-ostree upgrade daily at 03:15",
        "",
        "[Timer]",
        "OnCalendar=*-*-* 03:15:00",
        "Persistent=true",
        "",
        "[Install]",
        "WantedBy=timers.target",
        "EOF",

        // Enable the timers
        "systemctl enable update-tools.timer",
        "systemctl enable ostree-upgrade.timer"
      ]
    }
  ]
}
